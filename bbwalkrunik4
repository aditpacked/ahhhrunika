-- Services
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = game.Players.LocalPlayer

-- Multi-track URLs
local tracksURLs = {
    ["BC - 1"] = "https://raw.githubusercontent.com/aditpacked/ahhhrunika/refs/heads/main/BC_ARUNIKA.json",
    ["CP 1 - CP 2"] = "https://raw.githubusercontent.com/aditpacked/ahhhrunika/refs/heads/main/Arunika_cp1.json", 
    ["CP 2 - CP 3"] = "https://raw.githubusercontent.com/aditpacked/ahhhrunika/refs/heads/main/Arunika_cp2.json",
    ["CP 3 - CP 4"] = "https://raw.githubusercontent.com/aditpacked/ahhhrunika/refs/heads/main/Arunika_cp3.json",
    ["CP 4 - CP 5"] = "https://raw.githubusercontent.com/aditpacked/ahhhrunika/refs/heads/main/Arunika_cp4.json",
    ["CP 5 - SUMMIT"] = "https://raw.githubusercontent.com/aditpacked/ahhhrunika/refs/heads/main/SUMMIT_ARUNIKA.json",
}

local savedTracks = {}

-- Load Tracks
for name, url in pairs(tracksURLs) do
    local success, data = pcall(function()
        return HttpService:JSONDecode(game:HttpGet(url))
    end)

    if success and data and data.points then
        savedTracks[name] = {}
        for _, p in ipairs(data.points) do
            table.insert(savedTracks[name], Vector3.new(p[1], p[2], p[3]))
        end
    else
        savedTracks[name] = {}
    end
end

-- Variabel
local running = false
local speed = 16  -- default speed

local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

-- Respawn function
local function respawnPlayer()
    player.Character:BreakJoints()
end

-- GUI Setup (Aesthetic Minimalist Style)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MT_Arunika"
ScreenGui.Parent = CoreGui

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 300, 0, 300)
Frame.Position = UDim2.new(0.5, -150, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.BackgroundTransparency = 0.8 -- opacity 20%
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 12)

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "ðŸŒ™ MT Arunika"
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.BackgroundTransparency = 0.7
Title.TextColor3 = Color3.fromRGB(220, 220, 220)
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Instance.new("UICorner", Title).CornerRadius = UDim.new(0, 12)

-- Speed Box
local speedBox = Instance.new("TextBox", Frame)
speedBox.Size = UDim2.new(0.9, 0, 0, 40)
speedBox.Position = UDim2.new(0.05, 0, 0, 40)
speedBox.PlaceholderText = "Speed (default 16)"
speedBox.Text = tostring(speed)
speedBox.TextColor3 = Color3.fromRGB(220, 220, 220)
speedBox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
speedBox.BackgroundTransparency = 0.6
speedBox.TextScaled = true
speedBox.ClearTextOnFocus = false
speedBox.Font = Enum.Font.Gotham
Instance.new("UICorner", speedBox).CornerRadius = UDim.new(0, 8)

-- Scrollable Button Frame
local Scroll = Instance.new("ScrollingFrame", Frame)
Scroll.Size = UDim2.new(0.9, 0, 0, 150)
Scroll.Position = UDim2.new(0.05, 0, 0, 85)
Scroll.BackgroundTransparency = 1
Scroll.ScrollBarThickness = 4
Scroll.CanvasSize = UDim2.new(0, 0, 0, 240)
Scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

local UIList = Instance.new("UIListLayout", Scroll)
UIList.Padding = UDim.new(0, 5)
UIList.SortOrder = Enum.SortOrder.LayoutOrder

-- Ordered Track Buttons
local orderedTrackNames = {
    "BC - 1", "CP 1 - CP 2", "CP 2 - CP 3", "CP 3 - CP 4", "CP 4 - CP 5", "CP 5 - SUMMIT"
}

local function makeButton(text, parent, color)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(1, 0, 0, 35)
    btn.Text = text
    btn.BackgroundColor3 = color or Color3.fromRGB(30, 30, 30)
    btn.BackgroundTransparency = 0.5
    btn.TextColor3 = Color3.fromRGB(230, 230, 230)
    btn.TextScaled = true
    btn.Font = Enum.Font.Gotham
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    return btn
end

for _, name in ipairs(orderedTrackNames) do
    local btn = makeButton(name, Scroll)
    btn.MouseButton1Click:Connect(function()
        if running then return end
        running = true
        coroutine.wrap(function()
            playTrack(savedTracks[name])
            running = false
        end)()
    end)
end

-- Auto Summit Loop Button
local autoBtn = makeButton("AUTO SUMMIT (Loop)", Scroll, Color3.fromRGB(0, 100, 160))
autoBtn.MouseButton1Click:Connect(function()
    if running then return end
    running = true
    coroutine.wrap(function()
        while running do
            for _, name in ipairs(orderedTrackNames) do
                if not running then break end
                playTrack(savedTracks[name])
            end
            if running then
                respawnPlayer()
                task.wait(5)
            end
        end
        running = false
    end)()
end)

-- STOP Button
local stopBtn = makeButton("STOP", Frame, Color3.fromRGB(160, 40, 40))
stopBtn.Size = UDim2.new(0.9, 0, 0, 40)
stopBtn.Position = UDim2.new(0.05, 0, 0, 240)
stopBtn.TextColor3 = Color3.fromRGB(240, 240, 240)

stopBtn.MouseButton1Click:Connect(function()
    running = false
end)

-- Minimize Button
local closeBtn = Instance.new("TextButton", Frame)
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 0)
closeBtn.Text = "â€“"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
closeBtn.BackgroundTransparency = 0.4
closeBtn.TextScaled = true
closeBtn.Font = Enum.Font.GothamBold
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(1, 0)

closeBtn.MouseButton1Click:Connect(function()
    Frame.Visible = false
    local logoBtn = Instance.new("TextButton", ScreenGui)
    logoBtn.Size = UDim2.new(0, 40, 0, 40)
    logoBtn.Position = UDim2.new(0, 50, 0, 50)
    logoBtn.Text = "â˜€"
    logoBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    logoBtn.BackgroundTransparency = 0.5
    logoBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    logoBtn.TextScaled = true
    logoBtn.Font = Enum.Font.Gotham
    Instance.new("UICorner", logoBtn).CornerRadius = UDim.new(1, 0)

    logoBtn.MouseButton1Click:Connect(function()
        Frame.Visible = true
        logoBtn:Destroy()
    end)
end)

-- Drag Function (unchanged)
local function setupDrag(target)
    local dragging, dragStart, startPos
    target.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = target.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    target.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if dragging then
                local delta = input.Position - dragStart
                target.Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset + delta.X,
                    startPos.Y.Scale, startPos.Y.Offset + delta.Y
                )
            end
        end
    end)
end
setupDrag(Frame)

-- === Smooth PlayTrack Melayang 2 Stud ===
local function simplifyTrack(track, minDistance)
    local simple = {}
    local lastPos = nil
    for _, pos in ipairs(track) do
        if not lastPos or (pos - lastPos).Magnitude >= minDistance then
            table.insert(simple, pos)
            lastPos = pos
        end
    end
    return simple
end

-- FUNCTION PLAYTRACK YANG SUDAH DIPERBAIKI --
function playTrack(track)
    if not track or #track < 2 then return end
    local hrp = getHRP()
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    
    -- Buang titik terlalu rapet
    local smoothTrack = simplifyTrack(track, 3)

    for i = 2, #smoothTrack do
        if not running then break end

        local startPos = Vector3.new(smoothTrack[i-1].X, smoothTrack[i-1].Y, smoothTrack[i-1].Z)
        local targetPos = Vector3.new(smoothTrack[i].X, smoothTrack[i].Y, smoothTrack[i].Z)
        
        local distance = (targetPos - startPos).Magnitude
        local duration = distance / speed
        local elapsed = 0

        while elapsed < duration and running do
            elapsed += RunService.Heartbeat:Wait()
            local alpha = math.clamp(elapsed / duration, 0, 1)
            local currentPos = startPos:Lerp(targetPos, alpha)
            
            -- Biarkan physics natural, cuma teleport ke posisi berikutnya
            hrp.CFrame = CFrame.new(currentPos)
            
            -- Kasih jump power biar bisa lompati obstacle
            if humanoid then
                humanoid.JumpPower = 50
                humanoid.Jump = true
            end
        end
    end
    
    -- Reset jump power
    if humanoid then
        humanoid.JumpPower = 50
    end
end
